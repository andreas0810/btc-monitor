<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BTC Monitor</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0;
    padding: 40px;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.price-box {
    background: #1f1f1f;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
    min-width: 350px;
}

.price-title {
    font-size: 22px;
    color: #aaa;
}

.price-value {
    font-size: 54px;
    margin-top: 15px;
    font-weight: bold;
}

.center-box {
    text-align: center;
    margin-top: 80px;
}

.balance {
    font-size: 42px;
    margin-top: 15px;
}

.subinfo {
    margin-top: 15px;
    font-size: 20px;
    color: #aaa;
}

.block-info {
    margin-top: 60px;
    text-align: center;
    font-size: 18px;
    color: #ccc;
}

.reload-btn {
    margin-top: 60px;
    text-align: center;
}

button {
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #333;
    color: white;
}

button:hover {
    background: #555;
}
</style>
</head>

<body>

<div class="header">
    <div></div>
    <div class="price-box">
        <div class="price-title">Bitcoin Preis (USD)</div>
        <div id="btcPrice" class="price-value">Lade...</div>
    </div>
</div>

<div class="center-box">
    <div style="font-size:16px; color:#888;">
        bc1qpmvg0xqvqy38hfkr0c7pmxtxzxz9vlvp27f7rw
    </div>

    <div id="balance" class="balance">Lade...</div>
    <div id="usdValue" class="subinfo"></div>
</div>

<div class="block-info">
    <div id="blockHeight">Aktueller Block: Lade...</div>
    <div id="blockTime">Blockzeit: Lade...</div>
</div>

<div class="reload-btn">
    <button onclick="manualReload()">Seite händisch neu laden</button>
</div>

<script>
const address = "bc1qpmvg0xqvqy38hfkr0c7pmxtxzxz9vlvp27f7rw";

async function loadData() {
    try {

        // Adresse abrufen
        const addressRes = await fetch("https://blockstream.info/api/address/" + address);
        const addressJson = await addressRes.json();

        const funded = addressJson.chain_stats.funded_txo_sum / 100000000;
        const spent = addressJson.chain_stats.spent_txo_sum / 100000000;
        const balance = funded - spent;

        document.getElementById("balance").innerHTML =
            balance.toFixed(8) + " BTC";

        // BTC Preis (CoinGecko API)
        const priceRes = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
        const priceJson = await priceRes.json();
        const price = priceJson.bitcoin.usd;

        document.getElementById("btcPrice").innerHTML =
            "$ " + price.toLocaleString();

        const usdValue = balance * price;

        document.getElementById("usdValue").innerHTML =
            "Wert: $" + usdValue.toLocaleString(undefined, {maximumFractionDigits: 2});

        // Browser Tab Titel aktualisieren
        document.title = "BTC $" + price.toLocaleString();

        // Blockhöhe
        const blockHeightRes = await fetch("https://blockstream.info/api/blocks/tip/height");
        const blockHeight = await blockHeightRes.text();

        document.getElementById("blockHeight").innerHTML =
            "Aktueller Block: " + blockHeight;

        // Block Hash
        const blockHashRes = await fetch("https://blockstream.info/api/block-height/" + blockHeight);
        const blockHash = await blockHashRes.text();

        // Block Details
        const blockRes = await fetch("https://blockstream.info/api/block/" + blockHash);
        const blockJson = await blockRes.json();

        const blockDate = new Date(blockJson.timestamp * 1000);

        document.getElementById("blockTime").innerHTML =
            "Blockzeit: " + blockDate.toLocaleString();

    } catch (error) {
        console.log("Fehler beim Laden:", error);
    }
}

function manualReload() {
    location.reload();
}

// Initial laden
loadData();

// Auto Refresh alle 10 Minuten
setInterval(loadData, 600000);

</script>

</body>
</html>
