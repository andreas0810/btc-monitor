<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BTC Monitor</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #111;
    color: #eee;
    margin: 0;
    padding: 40px;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.time-box {
    font-size: 18px;
    color: #ccc;
}

.price-box {
    background: #1f1f1f;
    padding: 40px;
    border-radius: 12px;
    text-align: center;
    min-width: 350px;
}

.price-title {
    font-size: 22px;
    color: #aaa;
}

.price-value {
    font-size: 54px;
    margin-top: 15px;
    font-weight: bold;
}

.main-title {
    text-align: center;
    font-size: 48px;
    margin-top: 40px;
    font-weight: bold;
}

.center-box {
    text-align: center;
    margin-top: 60px;
}

.balance {
    font-size: 42px;
    margin-top: 15px;
}

.subinfo {
    margin-top: 15px;
    font-size: 20px;
    color: #aaa;
}

.block-info {
    margin-top: 60px;
    text-align: center;
    font-size: 18px;
    color: #ccc;
}

.reload-btn {
    margin-top: 40px;
    text-align: center;
}

button {
    padding: 12px 25px;
    font-size: 16px;
    cursor: pointer;
    border-radius: 6px;
    border: none;
    background: #333;
    color: white;
}

button:hover {
    background: #555;
}

.chart-container {
    margin-top: 60px;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
}
</style>
</head>

<body>

<div class="header">
    <div class="time-box">
        <div id="currentDate">Lade...</div>
        <div id="currentTime">Lade...</div>
    </div>

    <div class="price-box">
        <div class="price-title">Bitcoin Preis (USD)</div>
        <div id="btcPrice" class="price-value">Lade...</div>
    </div>
</div>

<div class="main-title">
    Bitcoin Lottery Mining
</div>

<div class="center-box">
    <div style="font-size:16px; color:#888;">
        bc1qpmvg0xqvqy38hfkr0c7pmxtxzxz9vlvp27f7rw
    </div>

    <div id="balance" class="balance">Lade...</div>
    <div id="usdValue" class="subinfo"></div>
</div>

<div class="block-info">
    <div id="blockHeight">Aktueller Block: Lade...</div>
    <div id="blockTime">Blockzeit: Lade...</div>
</div>

<div class="reload-btn">
    <button onclick="manualReload()">Seite h√§ndisch neu laden</button>
</div>

<div class="chart-container">
    <canvas id="hashrateChart"></canvas>
</div>

<script>
const address = "bc1qpmvg0xqvqy38hfkr0c7pmxtxzxz9vlvp27f7rw";

function updateClock() {
    const now = new Date();
    document.getElementById("currentDate").innerHTML =
        now.toLocaleDateString();
    document.getElementById("currentTime").innerHTML =
        now.toLocaleTimeString();
}
setInterval(updateClock, 1000);
updateClock();

async function loadData() {
    try {

        // Adresse
        const addressRes = await fetch("https://blockstream.info/api/address/" + address);
        const addressJson = await addressRes.json();
        const funded = addressJson.chain_stats.funded_txo_sum / 100000000;
        const spent = addressJson.chain_stats.spent_txo_sum / 100000000;
        const balance = funded - spent;
        document.getElementById("balance").innerHTML =
            balance.toFixed(8) + " BTC";

        // Preis
        const priceRes = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
        const priceJson = await priceRes.json();
        const price = priceJson.bitcoin.usd;

        document.getElementById("btcPrice").innerHTML =
            "$ " + price.toLocaleString();

        document.title = "BTC $" + price.toLocaleString();

        document.getElementById("usdValue").innerHTML =
            "Wert: $" + (balance * price).toLocaleString(undefined, {maximumFractionDigits:2});

        // Block
        const blockHeightRes = await fetch("https://blockstream.info/api/blocks/tip/height");
        const blockHeight = await blockHeightRes.text();
        document.getElementById("blockHeight").innerHTML =
            "Aktueller Block: " + blockHeight;

        const blockHashRes = await fetch("https://blockstream.info/api/block-height/" + blockHeight);
        const blockHash = await blockHashRes.text();

        const blockRes = await fetch("https://blockstream.info/api/block/" + blockHash);
        const blockJson = await blockRes.json();
        const blockDate = new Date(blockJson.timestamp * 1000);

        document.getElementById("blockTime").innerHTML =
            "Blockzeit: " + blockDate.toLocaleString();

        // Hashrate (Blockchain.info API)
        const hashRes = await fetch("https://api.blockchain.info/charts/hash-rate?timespan=30days&format=json");
        const hashJson = await hashRes.json();

        const labels = hashJson.values.map(v =>
            new Date(v.x * 1000).toLocaleDateString());
        const data = hashJson.values.map(v => v.y);

        new Chart(document.getElementById('hashrateChart'), {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Bitcoin Hashrate (TH/s)',
                    data: data,
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: { labels: { color: "#eee" } }
                },
                scales: {
                    x: { ticks: { color: "#aaa" } },
                    y: { ticks: { color: "#aaa" } }
                }
            }
        });

    } catch (error) {
        console.log(error);
    }
}

function manualReload() {
    location.reload();
}

loadData();
setInterval(loadData, 600000);
</script>

</body>
</html>
